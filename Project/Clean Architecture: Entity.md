<div dir='rtl'>

# ูุณุชูุฏ ูุนูุงุฑ โ ูุงู `entities`

### ุชุนุฑู ูุงู Entities ุฏุฑ Clean Architecture

> ูุงู `entities` ุดุงูู **ููุฌูุฏุชโูุง ุฏุงููู (Domain Entities)** ู **ููุงูู ุจูุงุฏู ุณุณุชู** ุงุณุช. ุงู ููุฌูุฏุชโูุง ูุณุชูู ุงุฒ ุงุจุฒุงุฑูุงุ ูพุงฺฏุงู ุฏุงุฏูุ API ุง UI ูุณุชูุฏ. ุขูโูุง ูพุงูโุงโุชุฑู ูุงุญุฏูุง ููุทู ูพุฑูฺู ูุณุชูุฏ ฺฉู ุฑูุชุงุฑ ุชุฌุงุฑ (Business Rules) ุฑุง ุฏุฑ ุฎูุฏ ุฌุง ุฏุงุฏูโุงูุฏ.

---

### ูุฏู ุงู ูุงู ุฏุฑ ูพุฑูฺู ูุง:

> ูุฏูโุณุงุฒ ููุงูู ฺฉูุฏ ุจุงุฒุงุฑ ุขูพุดูโูุง ฺฉุฑูพุชู ูุซู Option, Underlying, ArbitrageOpportunity ุจูโุดฺฉู ูุณุชููุ ุฏููุ ู ูุงุจู ุชุณุช.
>
> ุงู ููุฌูุฏุชโูุง ุจุงุฏ ุชูุงูุง ุงูุฌุงู ูุญุงุณุจุงุช ุง ุจุฑุฑุณ ุงุนุชุจุงุฑ (Validation) ุฑุง ุจุฏูู ูุงุจุณุชฺฏ ุจู ูฺ ุชฺฉููููฺ ุฎุงุต ุฏุงุดุชู ุจุงุดูุฏ.

---

### ฺฉูุงุณโูุง ู ูุงฺููโูุง ูพุดููุงุฏ ุฏุฑ `entities`

| ฺฉูุงุณ / ูุงฺูู    | ุชูุถุญ                                                                             | ุฏูู ุทุฑุงุญ                                                                           |
| ------------------------ | -------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------- |
| `Option`               | ูุฏู ฺฉุงูู ฺฉ ูุฑุงุฑุฏุงุฏ ุงุฎุชุงุฑ ูุนุงููู (Call/Put)               | ููุฌูุฏุช ุงุตู ุชุญููุ ุดุงูู ูุชุฏูุง ูุงููุฏ `is_in_the_money()` |
| `UnderlyingAsset`      | ุฏุงุฑุง ูพุงู ูุซู BTC ุง ETH                                              | ูฺฏูุฏุงุฑูุฏู ููุช ู ููุชูุช ุจุฑุง ููุชโฺฏุฐุงุฑ ุขูพุดู        |
| `ArbitrageOpportunity` | ุชุนุฑู ูุฑุตุช ุขุฑุจุชุฑุงฺ ุจุง ุณูุฏุ ูุฒูู ู ุฏุฑุตุฏ ุจุงุฒุฏู | ฺฉ ููุฌูุฏุช ูุณุชูู ูุงุจู ุฐุฎุฑูุ ููุงุด ุง ูุดุฏุงุฑ               |
| `OptionLeg`            | ุจุฎุด ฺฉ legs ุฏุฑ ุงุณุชุฑุงุชฺ ุชุฑฺฉุจ (ูุซู call ุฏุฑ Collar)          | ููุงุณุจ ุจุฑุง ุชุฑฺฉุจ ุฏุฑ ุงุณุชุฑุงุชฺโูุง                                    |
| `OptionStrategy`       | ุงุณุชุฑุงุชฺโูุง ุชุฑฺฉุจ ูุซู Spread ุง Collar                        | ฺฉูฺฉ ุจู ูุฏูโุณุงุฒ ุฑูุชุงุฑ ุชุฑฺฉุจ ู ุงุฑุฒุงุจ ุขูโูุง             |
| `Greeks`               | ุดุก ุงุฑุฒุดโูุญูุฑ ุจุฑุง ูฺฏูุฏุงุฑ Delta, Vega, Gamma                   | ุจุฑุง ูุญุงุณุจู ุฑุณฺฉ ู ุงูุทุจุงู ุจุง ูุฏูโูุง ูุงู                   |
| `Money`                | ุดุก ุงุฑุฒุดโูุญูุฑ ุจุฑุง ููุชโูุง ุจุง ุฏูุช ุจุงูุง                 | ุฌููฺฏุฑ ุงุฒ ุฎุทุง float ู ูพุดุชุจุงู ฺูุฏ ุงุฑุฒ                        |
| `TimeToExpiry`         | ุฒูุงู ุจุงูโูุงูุฏู ุชุง ุงููุถุง (ุฏุฑ ุฑูุฒ ุง ุณุงู)                | ููุฑุฏ ุงุณุชูุงุฏู ุฏุฑ ูุญุงุณุจุงุช ูุงู ูุงููุฏ Black-Scholes                 |

---

### ุฏูุงู ุทุฑุงุญ ู ุงุณุชููุงู ุงุฒ ูุงูโูุง ุฏฺฏุฑ:

* ุงู ฺฉูุงุณโูุง **ูฺ ูุงุจุณุชฺฏโุง ุจู ูพุงฺฏุงูโุฏุงุฏูุ APIุ ูุฑูุช JSONุ ุง ูุงุจุฑุฑโูุง ุฎุงุต** ูุฏุงุฑูุฏ.
* ุฏุฑ ุตูุฑุช ุชุนูุถ ูุจโุณุฑูุณ ุง ุฏุชุงุจุณุ ูฺ ุชุบุฑ ุฏุฑ `entities` ูุงุฒ ูุณุช.
* ุชุณุช ุขูโูุง ุจุณุงุฑ ุณุงุฏู ุงุณุช (no mocking).

---

### ุงุฑุชุจุงุท ุจู ููุฌูุฏุชโูุง (ุฏุฑูู ูุงู `entities`)

```mermaid
classDiagram
class UnderlyingAsset {
    +symbol: str
    +price: float
    +volatility: float
}

class Option {
    +symbol: str
    +type: str
    +strike: float
    +expiry: datetime
    +premium: float
    +underlying: UnderlyingAsset
    +get_payoff()
    +is_in_the_money()
}

class ArbitrageOpportunity {
    +option: Option
    +expected_profit: float
    +cost: float
    +yield: float
    +is_profitable()
}

class Greeks {
    +delta: float
    +gamma: float
    +vega: float
    +theta: float
}

Option --> UnderlyingAsset
Option --> Greeks
ArbitrageOpportunity --> Option
```

---

### ุงุฑุชุจุงุท ุจุง ุญูููโูุง ุจุฑูู ูุนูุงุฑ

| ุญููู ุจุฑูู | ูุญูู ุชุนุงูู ุจุง `entities`                                                                                                                            |
| --------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `use_cases`         | ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉูุงุณโูุง ูุซู `Option`ู `ArbitrageOpportunity`ุ ููุทู ฺฉุดู ูุฑุตุชโูุง ุฑุง ูพุงุฏูโุณุงุฒ ูโฺฉูุฏ |
| `interfaces/api`    | ุฏุงุฏูโูุง ุฑุง ุงุฒ ฺฉุงุฑุจุฑ ฺฏุฑูุชู ู ุขูโูุง ุฑุง ุจู ุงุดุงุก `entities`ุชุจุฏู ูโฺฉูุฏ ู ุจุฑูโฺฏุฑุฏุงูุฏ                  |
| `infrastructure/db` | ุงุดุงุก `entities`ุฑุง serialize ูโฺฉูุฏ ุง ุงุฒ ุฑู ุฏุงุฏูโูุง ุฏุชุงุจุณ ุจุงุฒุณุงุฒ ูโฺฉูุฏ                                  |
| `data_providers`    | ุฏุงุฏูโูุง ุฑุง ฺฏุฑูุชู ู ุขูโูุง ุฑุง ุจู ููุฌูุฏุชโูุง ูุงููุฏ `Option`ุง `UnderlyingAsset`ููพ ูโฺฉูุฏ                   |

---

### ุงุตูู ุทุฑุงุญ ุญุฑููโุง ุฑุนุงุชโุดุฏู

| ุงุตู                               | ุชูุถุญ                                                                                                               |
| ------------------------------------ | ------------------------------------------------------------------------------------------------------------------------ |
| **Single Responsibility**      | ูุฑ ฺฉูุงุณ ููุท ฺฉ ููุด ุฏุงุฑุฏ (Option ููุท ฺฉ ูุฑุงุฑุฏุงุฏ ุฑุง ูุฏู ูโฺฉูุฏ)                   |
| **Independence**               | ูฺ ูุงุจุณุชฺฏ ุจู ูุฑูโูุฑฺฉ ุง ุงุจุฒุงุฑูุง I/O ูุฏุงุฑุฏ                                         |
| **Immutability (ุฏุฑ VOูุง)** | ุงุดุงุก ูุงููุฏ `Greeks`ู `Money`ุชุบุฑูุงูพุฐุฑูุฏ                                                   |
| **Self-validation**            | ูุชุฏูุง ูุงููุฏ `is_profitable()`ุง `is_in_the_money()`ุฏุฑูู ููุฌูุฏุชโูุง ูุฑุงุฑ ุฏุงุฑูุฏ |
| **Testability**                | ูโุชูุงู ููู ฺฉูุงุณโูุง ุฑุง ุฏุฑ ูุงุญุฏ ุฌุฏุงฺฏุงูู ุชุณุช ฺฉุฑุฏ                                     |

---

### ููุงุจุน ู ุงูฺฏููุง ูุนุชุจุฑ

* [Clean Architecture - Uncle Bob](https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html)
* [Domain-Driven Design by Eric Evans](https://domainlanguage.com/ddd/)
* [Designing Data-Intensive Applications - Martin Kleppmann](https://dataintensive.net/)
* [Functional Programming in Finance](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4235853)
* [Fintech Engineering Principles by Plaid](https://plaid.com/blog/fintech-product-engineering-principles/)


# Option ุฏุฑ ูุงู `entities`

#### ูฺฺฏโูุง (Attributes)

| ูฺฺฏ              | ููุน                      | ุชูุถุญ                        |
| ------------------ | ------------------------ | ---------------------------- |
| `contract_name`    | `str`                    | ูุงู ุงุณุชุงูุฏุงุฑุฏ ูุฑุงุฑุฏุงุฏ ุขูพุดู   |
| `option_type`      | `Enum` (`call` ุง `put`) | ููุน ูุฑุงุฑุฏุงุฏ                  |
| `strike_price`     | `float`                  | ููุช ุงุนูุงู                   |
| `expiry`           | `datetime`               | ุฒูุงู ุงููุถุง                   |
| `premium`          | `float`                  | ููุช ูุนู ุขูพุดู               |
| `underlying_asset` | `UnderlyingAsset`        | ุฏุงุฑุง ูพุงู ูุงููุฏ BTC ุง ETH |

---

#### ูุชุฏูุง ฺฉูุฏ (Behavior)

| ูุชุฏ                                     | ุฎุฑูุฌ   | ุชูุถุญ                                           |
| --------------------------------------- | ------- | ----------------------------------------------- |
| `is_in_the_money(spot_price: float)`    | `bool`  | ุจุฑุฑุณ ุณูุฏููุฏ ุขูพุดู ูุณุจุช ุจู ููุช ูุนู ุฏุงุฑุง     |
| `get_payoff(spot_price: float)`         | `float` | ูุญุงุณุจู ุณูุฏ ููุง ุขูพุดู ุฏุฑ ุฒูุงู ุณุฑุฑุณุฏ            |
| `get_break_even_price()`                | `float` | ูุญุงุณุจู ููุทูโ ุณุฑุจูโุณุฑ ุจุฑุง ุฎุฑุฏุงุฑ ุขูพุดู          |
| `has_expired(reference_time: datetime)` | `bool`  | ุจุฑุฑุณ ุงููุถุง ุขูพุดู ุฏุฑ ฺฉ ุฒูุงู ูุดุฎุต               |
| `is_valid()`                            | `bool`  | ุจุฑุฑุณ ุงุนุชุจุงุฑ ููุทู ุขูพุดู (ูุซูุงู ููุช ููู ูุจุงุดุฏ) |

---

#### ูุชุฏูุง ุญุฐูโุดุฏู ุฏุฑ ุงู ูุณุฎู

* `is_out_of_the_money`ุ `is_at_the_money`: ูุชุฌู ุงู ูุชุฏูุง ุจุง ุดุฑุท ุณุงุฏู ุฑู `is_in_the_money` ู `strike_price` ูุงุจู ุงุณุชุฎุฑุงุฌโุงูุฏ.
* `get_max_loss`: ุจุดุชุฑ ุจุฑุง use case ุงุณุชุฑุงุชฺโูุง ููุฏ ุงุณุช ูู ุฏุฑ ุฎูุฏ Option.
* `is_similar_to`: ูุฑุจูุท ุจู ููุงุณู ุฏุฑ ุงุณุชุฑุงุชฺโูุง ุง ุจฺฉโุชุณุช ุงุณุชุ ูู ุฏุฑูู ููุฌูุฏุช Option.

---

### ุฌุฏูู ูุณุชูุฏ ููุง ุจุฑุง `Option`

| ฺฉูุงุณ / ูุงฺูู | ุชูุถุญ                                                                | ุฏูู ุทุฑุงุญ                                                                                                                                                                                                   |
| ------------ | -------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `Option`     | ูุฏู ูุฑุงุฑุฏุงุฏ ุงุฎุชุงุฑ ูุนุงููู ุดุงูู ูฺฺฏโูุง ุงุณุงุณ ู ุฑูุชุงุฑูุง ฺฉูุฏ ูุงู | ููุฌูุฏุช ุงุตู ุชุญูู ฺฉู ุฏุฑ ุงฺฉุซุฑ use caseูุง ูุงููุฏ ููุชโฺฏุฐุงุฑุ ุขุฑุจุชุฑุงฺุ ุงุณุชุฑุงุชฺ ู ูุดุฏุงุฑ ุงุณุชูุงุฏู ูโุดูุฏ. ูุชุฏูุง ุงูุชุฎุงุจโุดุฏู ููุนฺฉุณโฺฉููุฏู ุฑูุชุงุฑูุง ุถุฑูุฑ ูุณุชูุฏ ู ุจูู ุจู use cases ุง value objects ููุชูู ูโุดููุฏ. |

---

* ูุฑุฒูุง `Entity` ุฑุง ุจุฑ ุงุณุงุณ ูุงูุนุช ูุงู ุชุนู ฺฉูู
* ุจุฏุงูู ฺู ููุงุฑุฏ ุฑุง ุจุงุฏ ุฏุฑ `Subclass` ุชูุณุนู ุฏูู (ูุซู `CryptoOption`, `StockOption`, `ETFOption`)
* ุงุฒ ุงุตู **Open/Closed** ุจูโุฏุฑุณุช ุงุณุชูุงุฏู ฺฉูู

---

## โ ุฌุฏูู ฺฉุงุฑุจุฑุฏ ฺฉูุงุณ `Option` ุฏุฑ ุงููุงุน ุจุงุฒุงุฑูุง

| ููุน ุจุงุฒุงุฑ                  | ฺฉุงุฑุจุฑุฏ `Option`                                                          | ุชูุงูุชโูุง ู ูุงุฒููุฏโูุง ุฎุงุต                                                                       | ุฑุงูฺฉุงุฑ ูพุดููุงุฏ                                                                     |
| -------------------------- | ------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- |
| **ฺฉุฑูพุชู (Crypto)**        | ูุฑุงุฑุฏุงุฏูุง ุขูพุดู ุจุฑ ุฏุงุฑุงโูุง ูุซู BTC, ETH ุฏุฑ ุงฺฉุณฺูุฌโูุง ูุงููุฏ Deribit | - ูุงุฒ ุจู ูพุดุชุจุงู ุงุฒ ูุฑุงุฑุฏุงุฏูุง ุฏุงุฆู<br>- ฺฉุงุฑูุฒุฏ ุฒุงุฏ ู ููุณุงู ุจุงูุง<br>- ุชุณูู ูุนูููุงู ุจุง ฺฉุฑูพุชู | ุณุงุฎุช ฺฉูุงุณ `CryptoOption` ุจุง ุงุฑุซ ุงุฒ `AbstractOption`                                 |
| **ุณูุงู (Stock Options)**   | ุขูพุดูโูุง Call/Put ุฑู ุณูุงู ุฎุงุต (ูุซูุงู AAPLุ TSLA)                        | - ุชุณูู ูุนูููุงู ุจุง ูพูู ููุฏ<br>- ูุงุฒ ุจู ุชุทุงุจู ุจุง ูุฏู ุขูุฑฺฉุง ุง ุงุฑููพุง<br>- ููุงูู FINRA ุง SEC | ุณุงุฎุช ฺฉูุงุณ `StockOption` ุจุง ุงุถุงููโฺฉุฑุฏู ูฺฺฏโูุง ูุซู `style: 'european'/'american'` |
| **ุตูุฏููโูุง (ETF Options)** | ุขูพุดู ุฑู ุดุงุฎุตโูุง ุง ETFูุง ุจุฒุฑฺฏ (ูุซูุงู SPYุ QQQ)                         | - ุฑูุชุงุฑ ูุฒุฏฺฉ ุจู ุณูุงู<br>- ููุฏุดููุฏฺฏ ุจุงูุงุ ูู ุชุญูู ูุชูุงูุช                                       | ุงุณุชูุงุฏู ุงุฒ `StockOption` ุจุง ุงูุฏฺฉ ุชุบุฑ ุง ฺฉ `ETFOption` ุงุฎุชุตุงุต ุฏุฑ ุตูุฑุช ูุงุฒ      |

---

## ๐ ุชูุงูุชโูุง ฺฉูุฏ ุจู ุงู Optionูุง

| ุชูุงูุช              | ฺฉุฑูพุชู           | ุณูุงู                 | ETF         |
| ------------------ | ---------------- | -------------------- | ----------- |
| ุชุณูู              | ุจุง ุฑูุฒุงุฑุฒ (BTC)  | ุจุง ุฏูุงุฑ              | ุจุง ุฏูุงุฑ     |
| ููุณุงู              | ุจุณุงุฑ ุฒุงุฏ       | ูุชูุณุท                | ฺฉู ุชุง ูุชูุณุท |
| ุนูู ุจุงุฒุงุฑ          | ูพุงูโุชุฑ         | ุจุงูุง                 | ุจุงูุง        |
| ุณุจฺฉ ุขูพุดู           | ุงุบูุจ ุงุฑููพุง     | ุขูุฑฺฉุง ู ุงุฑููพุง   | ุงุฑููพุง     |
| ูุงุฒ ุจู Greeks     | ุจูู              | ุจูู                  | ุจูู         |
| ุฏุงุฏูโูุง ุฒูุฌุฑูโุง | WebSocket ู ูุดุชู | ุฑุณู (Yahoo, Nasdaq) | ูุดุงุจู ุณูุงู  |

---

## โ ุณุงุฎุชุงุฑ ฺฉูุงุณโูุง ุจุฑ ุงุณุงุณ ุงุฑุซโุจุฑ ุงุฒ `AbstractOption`



</div>

```plaintext
AbstractOption (Entity Base)
โโโ CryptoOption       # ูฺฺฏโูุง ุฎุงุต ุจุงุฒุงุฑ ุฑูุฒ ุงุฑุฒ
โโโ StockOption        # ููุงุณุจ ุจุงุฒุงุฑ ุณูุช ุณูุงู
โโโ ETFOption (ุงุฎุชุงุฑ) # ุฏุฑ ุตูุฑุช ูุงุฒ ุจู ููุทู ุฌุฏุงฺฏุงูู
```
<div dir='rtl'>
---

## โ ุฎูุงุตู

| ฺฉูุงุณ                         | ฺฉุงุฑุจุฑุฏ                                        | ูฺฺฏ ุฎุงุต                                  |
| ---------------------------- | --------------------------------------------- | ------------------------------------------ |
| `AbstractOption`             | ุณุงุฎุชุงุฑ ูพุงู ุจุฑุง ูุฑ ููุน ูุฑุงุฑุฏุงุฏ ุงุฎุชุงุฑ ูุนุงููู | ุชุนุฑู ูฺฺฏโูุง ู ูุชุฏูุง ุนููู              |
| `CryptoOption`               | ุจุงุฒุงุฑ ูุดุชูุงุช ุฑูุฒุงุฑุฒ                          | ูพุดุชุจุงู ุงุฒ APIูุง realtimeุ ูุฒููโูุง ุฎุงุต |
| `StockOption`                | ุจุงุฒุงุฑ ุณูุงู ุณูุช                               | ูพุดุชุจุงู ุงุฒ ุณุจฺฉโูุง ูุฎุชูู ุงุฌุฑุง             |
| `ETFOption` *(ุฏุฑ ุตูุฑุช ูุงุฒ)* | ุจุฑุง ุชุญูู ุขูพุดูโูุง ุฑู ุตูุฏููโูุง ุดุงุฎุต        | ุดุจู Stock ูู ููฺฉู ุงุณุช Greeks ูุชูุงูุช ุจุงุดุฏ |

---




